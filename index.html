<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a2a">
    <title>ùìì DREAM OS v2.0</title>
    <style>
        /* [KEEP ALL CSS FROM ABOVE - SAME AS BEFORE] */
        /* Karena panjang, saya keep semua CSS yang sudah ada */
        /* Full CSS tetap sama seperti di atas */
    </style>
</head>
<body>
    <!-- [KEEP ALL HTML STRUCTURE FROM ABOVE] -->
    <!-- Full HTML structure tetap sama -->
    
    <script>
        // ============================================
        // DREAM OS v2.0 - COMPLETE WITH REAL DATA
        // ============================================

        // REAL DATA - 18 SARANA
        const SARANA = [
            { id: 1, name: "Aula SMP", division: "SMP", includes: ["sound", "lighting", "ac", "projector"], status: "active" },
            { id: 2, name: "Aula SMA", division: "SMA", includes: ["sound", "projector"], status: "active" },
            { id: 3, name: "Saung Besar", division: "UMUM", includes: ["sound"], status: "active" },
            { id: 4, name: "Saung Kecil", division: "UMUM", includes: [], status: "active" },
            { id: 5, name: "Masjid", division: "UMUM", includes: ["sound"], status: "maintenance" },
            { id: 6, name: "Serbaguna", division: "UMUM", includes: ["sound"], status: "active" },
            { id: 7, name: "Labkom SD", division: "SD", includes: [], status: "active" },
            { id: 8, name: "Labkom SMP", division: "SMP", includes: [], status: "active" },
            { id: 9, name: "Labkom SMA", division: "SMA", includes: [], status: "active" },
            { id: 10, name: "Lapangan Volley", division: "UMUM", includes: [], status: "active" },
            { id: 11, name: "Lapangan Basket", division: "UMUM", includes: [], status: "active" },
            { id: 12, name: "Lapangan SMA", division: "SMA", includes: [], status: "active" },
            { id: 13, name: "Lapangan Tanah", division: "UMUM", includes: [], status: "active" },
            { id: 14, name: "Kantin SMP", division: "SMP", includes: [], status: "active" },
            { id: 15, name: "Kantin SMA", division: "SMA", includes: [], status: "active" },
            { id: 16, name: "Perpus SD", division: "SD", includes: [], status: "active" },
            { id: 17, name: "Perpus SMP", division: "SMP", includes: [], status: "active" },
            { id: 18, name: "Perpus SMA", division: "SMA", includes: [], status: "active" }
        ];

        // REAL DATA - 12 ALAT
        const ALAT = [
            { id: 1, name: "Sound Portable", category: "audio", total: 5, available: 5 },
            { id: 2, name: "Projector", category: "visual", total: 10, available: 10 },
            { id: 3, name: "Mic Standing", category: "audio", total: 10, available: 10 },
            { id: 4, name: "Meja Panjang", category: "furniture", total: 20, available: 20 },
            { id: 5, name: "Meja Siswa", category: "furniture", total: 100, available: 100 },
            { id: 6, name: "Meja Oshin", category: "furniture", total: 50, available: 50 },
            { id: 7, name: "Kursi Futura", category: "furniture", total: 200, available: 200 },
            { id: 8, name: "Kursi Chitose", category: "furniture", total: 200, available: 200 },
            { id: 9, name: "Kursi Siswa", category: "furniture", total: 300, available: 300 },
            { id: 10, name: "Kabel HDMI", category: "kabel", total: 20, available: 20 },
            { id: 11, name: "Kabel VGA", category: "kabel", total: 20, available: 20 },
            { id: 12, name: "Kabel Rol AC (Extention)", category: "kabel", total: 15, available: 15 }
        ];

        // APP CONFIG
        const CONFIG = {
            appName: 'DREAM OS',
            version: '2.0.0',
            author: 'Dream Team: Mr. M + Mr. DSeek + Mrs. Qwen',
            launchDate: '7 Januari 2026',
            
            // Business Rules
            businessRules: {
                normalHours: { start: '07:30', end: '16:00' },
                fridayHours: { start: '10:30', end: '13:00' },
                blockedFriday: ['Aula SMP', 'Serbaguna', 'Masjid'],
                noWeekendBooking: true
            },
            
            // WhatsApp
            whatsapp: {
                phone: '628886183954',
                testMode: true,
                testPhone: '6281234567890'
            },
            
            // Passwords
            passwords: {
                booking: 'booking123',
                k3: 'k3123',
                security: 'security123',
                admin: '@dm1n_Sec2025',
                architect: '418626'
            }
        };

        // STATE
        let currentTab = 'booking';
        let k3Photos = [];
        let cameraStream = null;

        // INITIALIZE APP
        function initializeApp() {
            console.log('üöÄ DREAM OS v2.0 Initializing...');
            
            // Setup UI
            setupUI();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check connection
            updateConnectionStatus();
            
            console.log('‚úÖ DREAM OS Ready!');
        }

        // SETUP UI
        function setupUI() {
            // Populate facilities
            populateFacilities();
            
            // Populate K3 locations
            populateK3Locations();
            
            // Populate tools
            populateTools();
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').value = today;
            document.getElementById('bookingDate').min = today;
            
            // Generate time slots
            generateTimeSlots();
            
            // Show initial tab
            showTab('booking');
        }

        // POPULATE FACILITIES
        function populateFacilities() {
            const select = document.getElementById('facility');
            select.innerHTML = '<option value="">-- Pilih Sarana --</option>';
            
            SARANA.forEach(sarana => {
                const option = document.createElement('option');
                option.value = sarana.id;
                option.textContent = `${sarana.name} (${sarana.division})`;
                option.dataset.division = sarana.division;
                select.appendChild(option);
            });
        }

        // FILTER FACILITIES BY DIVISION
        function filterFacilities() {
            const division = document.getElementById('division').value;
            const select = document.getElementById('facility');
            
            Array.from(select.options).forEach(option => {
                if (!option.value) return;
                
                if (division === "" || option.dataset.division === division) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
            
            // Reset selection
            select.value = "";
            document.getElementById('facilityInfo').style.display = 'none';
        }

        // SHOW FACILITY INFO
        function showFacilityInfo() {
            const facilityId = document.getElementById('facility').value;
            if (!facilityId) {
                document.getElementById('facilityInfo').style.display = 'none';
                return;
            }
            
            const sarana = SARANA.find(s => s.id == facilityId);
            if (!sarana) return;
            
            const includesList = document.getElementById('includesList');
            const facilityStatus = document.getElementById('facilityStatus');
            
            includesList.textContent = sarana.includes.length > 0 
                ? sarana.includes.join(', ') 
                : "Tidak ada alat include";
            
            if (sarana.status === 'maintenance') {
                facilityStatus.innerHTML = '<span style="color:#ff4757">üîß Maintenance</span>';
            } else {
                facilityStatus.innerHTML = '<span style="color:#2ed573">‚úÖ Tersedia</span>';
            }
            
            document.getElementById('facilityInfo').style.display = 'block';
        }

        // GENERATE TIME SLOTS
        function generateTimeSlots() {
            const dateInput = document.getElementById('bookingDate').value;
            if (!dateInput) return;
            
            const date = new Date(dateInput);
            const day = date.getDay(); // 0=Minggu, 5=Jumat
            const isFriday = (day === 5);
            const isWeekend = (day === 0 || day === 6);
            
            const container = document.getElementById('timeSlots');
            const rules = document.getElementById('timeRules');
            const rulesText = document.getElementById('rulesText');
            
            container.innerHTML = '';
            
            // Weekend check
            if (isWeekend && CONFIG.businessRules.noWeekendBooking) {
                container.innerHTML = `
                    <div class="warning-box">
                        <strong>‚ùå Tidak bisa booking weekend!</strong><br>
                        Booking hanya tersedia hari Senin sampai Jumat.
                    </div>
                `;
                rules.style.display = 'none';
                return;
            }
            
            // Generate slots based on day
            let slots = [];
            let rulesHtml = '';
            
            if (isFriday) {
                // Jumat: 10:30-13:00
                rulesHtml = `
                    ‚Ä¢ Jumat: 10:30 - 13:00 WIB<br>
                    ‚Ä¢ <span style="color:#ff4757">Aula SMP, Serbaguna, Masjid tidak bisa dibooking</span><br>
                    ‚Ä¢ Prepare shalat Jumat dan shalat Jumat
                `;
                
                slots = [
                    { start: '10:30', end: '11:30' },
                    { start: '11:30', end: '12:30' },
                    { start: '12:30', end: '13:00' }
                ];
            } else {
                // Normal: 07:30-16:00
                rulesHtml = `
                    ‚Ä¢ Senin-Kamis: 07:30 - 16:00 WIB<br>
                    ‚Ä¢ Slot per 1 jam<br>
                    ‚Ä¢ Booking harus minimal 1 hari sebelumnya
                `;
                
                // Generate from 07:30 to 16:00
                slots.push({ start: '07:30', end: '08:30' });
                for (let i = 8; i < 16; i++) {
                    const start = `${i.toString().padStart(2, '0')}:00`;
                    const end = `${(i + 1).toString().padStart(2, '0')}:00`;
                    slots.push({ start, end });
                }
            }
            
            // Create slot buttons
            slots.forEach(slot => {
                const div = document.createElement('div');
                div.className = 'time-slot';
                div.textContent = `${slot.start} - ${slot.end}`;
                div.dataset.start = slot.start;
                div.dataset.end = slot.end;
                
                div.onclick = function() {
                    // Deselect all
                    document.querySelectorAll('.time-slot').forEach(s => {
                        s.classList.remove('selected');
                    });
                    
                    // Select this
                    this.classList.add('selected');
                };
                
                container.appendChild(div);
            });
            
            rulesText.innerHTML = rulesHtml;
            rules.style.display = 'block';
            
            // Check if selected facility is blocked on Friday
            if (isFriday) {
                const facilityId = document.getElementById('facility').value;
                if (facilityId) {
                    const sarana = SARANA.find(s => s.id == facilityId);
                    if (sarana && CONFIG.businessRules.blockedFriday.includes(sarana.name)) {
                        container.innerHTML = `
                            <div class="warning-box">
                                <strong>‚ùå Tidak bisa booking Jumat!</strong><br>
                                ${sarana.name} tidak tersedia hari Jumat karena prepare shalat Jumat.
                            </div>
                        `;
                    }
                }
            }
        }

        // POPULATE K3 LOCATIONS
        function populateK3Locations() {
            const select = document.getElementById('k3Location');
            select.innerHTML = '<option value="">-- Pilih Lokasi --</option>';
            
            SARANA.forEach(sarana => {
                const option = document.createElement('option');
                option.value = sarana.name;
                option.textContent = `${sarana.name} (${sarana.division})`;
                select.appendChild(option);
            });
        }

        // POPULATE TOOLS
        function populateTools() {
            const container = document.getElementById('toolsList');
            container.innerHTML = '';
            
            ALAT.forEach(tool => {
                const div = document.createElement('div');
                div.style.cssText = `
                    padding: 8px;
                    margin: 5px 0;
                    background: rgba(255,255,255,0.05);
                    border-radius: 5px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                div.innerHTML = `
                    <div>
                        <strong>${tool.name}</strong><br>
                        <small>Tersedia: ${tool.available}/${tool.total}</small>
                    </div>
                    <input type="number" min="0" max="${tool.available}" 
                           style="width: 60px; padding: 5px; border-radius: 4px; background: rgba(255,255,255,0.1); color: white; border: 1px solid #D4AF37;"
                           data-tool-id="${tool.id}"
                           placeholder="0">
                `;
                
                container.appendChild(div);
            });
        }

        // CAMERA FUNCTIONS
        function startCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        cameraStream = stream;
                        const video = document.getElementById('cameraPreview');
                        video.srcObject = stream;
                        video.style.display = 'block';
                        document.getElementById('captureBtn').style.display = 'inline-block';
                        document.getElementById('stopCameraBtn').style.display = 'inline-block';
                    })
                    .catch(err => {
                        alert('‚ùå Tidak bisa mengakses kamera: ' + err.message);
                    });
            } else {
                alert('‚ùå Browser tidak mendukung kamera');
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
                document.getElementById('cameraPreview').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'none';
                document.getElementById('stopCameraBtn').style.display = 'none';
            }
        }

        function capturePhoto() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const photoData = canvas.toDataURL('image/jpeg');
            addK3Photo(photoData);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        addK3Photo(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function addK3Photo(dataUrl) {
            if (k3Photos.length >= 3) {
                alert('‚ùå Maksimal 3 foto!');
                return;
            }
            
            k3Photos.push(dataUrl);
            updatePhotoPreview();
        }

        function updatePhotoPreview() {
            const container = document.getElementById('photosPreview');
            container.innerHTML = '';
            
            k3Photos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'photo-item';
                div.innerHTML = `
                    <img src="${photo}" alt="Foto ${index + 1}">
                    <button class="remove-photo" onclick="removePhoto(${index})">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function removePhoto(index) {
            k3Photos.splice(index, 1);
            updatePhotoPreview();
        }

        // SUBMIT BOOKING
        function submitBooking() {
            // Get form values
            const facilityId = document.getElementById('facility').value;
            const date = document.getElementById('bookingDate').value;
            const name = document.getElementById('bookingName').value;
            const phone = document.getElementById('bookingPhone').value;
            const purpose = document.getElementById('bookingPurpose').value;
            
            // Get selected time
            const selectedSlot = document.querySelector('.time-slot.selected');
            if (!selectedSlot) {
                alert('‚ùå Pilih waktu booking!');
                return;
            }
            
            // Validation
            if (!facilityId || !date || !name || !phone) {
                alert('‚ùå Harap lengkapi semua data!');
                return;
            }
            
            // Check Friday rules
            const sarana = SARANA.find(s => s.id == facilityId);
            const bookingDate = new Date(date);
            if (bookingDate.getDay() === 5 && CONFIG.businessRules.blockedFriday.includes(sarana.name)) {
                alert(`‚ùå ${sarana.name} tidak bisa dibooking hari Jumat!`);
                return;
            }
            
            // Generate booking code
            const bookingCode = 'BK-' + Date.now().toString().slice(-8);
            
            // Get selected tools
            const selectedTools = [];
            document.querySelectorAll('#toolsList input[type="number"]').forEach(input => {
                const qty = parseInt(input.value) || 0;
                if (qty > 0) {
                    const toolId = input.dataset.toolId;
                    const tool = ALAT.find(t => t.id == toolId);
                    if (tool) {
                        selectedTools.push({
                            name: tool.name,
                            quantity: qty
                        });
                    }
                }
            });
            
            // Create WhatsApp message
            let waMessage = `üìÖ BOOKING BARU - DREAM OS\n\n`;
            waMessage += `Kode: ${bookingCode}\n`;
            waMessage += `Sarana: ${sarana.name} (${sarana.division})\n`;
            waMessage += `Tanggal: ${date}\n`;
            waMessage += `Waktu: ${selectedSlot.dataset.start} - ${selectedSlot.dataset.end}\n`;
            waMessage += `Pemesan: ${name}\n`;
            waMessage += `HP: ${phone}\n`;
            waMessage += `Tujuan: ${purpose || '-'}\n`;
            
            if (selectedTools.length > 0) {
                waMessage += `\nAlat Tambahan:\n`;
                selectedTools.forEach(tool => {
                    waMessage += `‚Ä¢ ${tool.name} (${tool.quantity} unit)\n`;
                });
            }
            
            waMessage += `\nStatus: ‚è≥ Menunggu approval`;
            
            // Send WhatsApp
            const phoneNumber = CONFIG.whatsapp.testMode 
                ? CONFIG.whatsapp.testPhone 
                : CONFIG.whatsapp.phone;
            
            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(waMessage)}`, '_blank');
            
            // Save to localStorage
            const booking = {
                code: bookingCode,
                facility: sarana.name,
                date: date,
                time: `${selectedSlot.dataset.start}-${selectedSlot.dataset.end}`,
                name: name,
                phone: phone,
                purpose: purpose,
                tools: selectedTools,
                status: 'pending',
                timestamp: new Date().toISOString()
            };
            
            saveToLocalStorage('bookings', booking);
            
            // Show success message
            alert(`‚úÖ Booking berhasil!\n\nKode: ${bookingCode}\nPesan terkirim ke WhatsApp.`);
            
            // Reset form
            resetBookingForm();
            
            // Update recent bookings
            loadRecentBookings();
        }

        function saveToLocalStorage(key, data) {
            let items = JSON.parse(localStorage.getItem(key) || '[]');
            items.push(data);
            localStorage.setItem(key, JSON.stringify(items));
        }

        function loadRecentBookings() {
            const container = document.getElementById('recentBookings');
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            if (bookings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0a0c0;">Belum ada booking</p>';
                return;
            }
            
            let html = '';
            bookings.slice(-5).reverse().forEach(booking => {
                html += `
                    <div style="padding: 10px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <strong>${booking.code}</strong><br>
                        <small>${booking.facility} ‚Ä¢ ${booking.date}<br>
                        Status: <span style="color: #ffa502">${booking.status}</span></small>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function resetBookingForm() {
            document.getElementById('facility').value = '';
            document.getElementById('bookingName').value = '';
            document.getElementById('bookingPhone').value = '';
            document.getElementById('bookingPurpose').value = '';
            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
            document.querySelectorAll('#toolsList input').forEach(input => input.value = '');
            document.getElementById('facilityInfo').style.display = 'none';
        }

        // SUBMIT K3 REPORT
        function submitK3Report() {
            const type = document.getElementById('k3Type').value;
            const location = document.getElementById('k3Location').value;
            const description = document.getElementById('k3Description').value;
            const urgency = document.getElementById('k3Urgency').value;
            
            if (!type || !location || !description) {
                alert('‚ùå Harap isi jenis, lokasi, dan deskripsi!');
                return;
            }
            
            // Determine target based on type
            const target = {
                'kerusakan': 'Maintenance',
                'kehilangan': 'Security', 
                'kebersihan': 'Cleaning Service'
            }[type];
            
            // Create WhatsApp message
            let waMessage = `‚ö†Ô∏è LAPORAN K3 ‚Üí ${target}\n\n`;
            waMessage += `Jenis: ${type}\n`;
            waMessage += `Lokasi: ${location}\n`;
            waMessage += `Deskripsi: ${description}\n`;
            waMessage += `Urgensi: ${urgency}\n`;
            waMessage += `Foto: ${k3Photos.length} foto terlampir\n\n`;
            waMessage += `Status: üì• Diterima`;
            
            // Send WhatsApp
            const phoneNumber = CONFIG.whatsapp.testMode
                ? CONFIG.whatsapp.testPhone
                : CONFIG.whatsapp.phone;
            
            // Note: WhatsApp API doesn't support sending photos via URL parameters
            // For now, we'll just send the text message
            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(waMessage)}`, '_blank');
            
            // Save report locally
            const report = {
                type: type,
                location: location,
                description: description,
                urgency: urgency,
                photos: k3Photos.length,
                timestamp: new Date().toISOString()
            };
            
            saveToLocalStorage('k3_reports', report);
            
            alert(`‚úÖ Laporan K3 terkirim ke ${target}!`);
            
            // Reset form
            resetK3Form();
        }

        function resetK3Form() {
            document.getElementById('k3Type').value = '';
            document.getElementById('k3Location').value = '';
            document.getElementById('k3Description').value = '';
            document.getElementById('k3Urgency').value = 'normal';
            k3Photos = [];
            updatePhotoPreview();
            stopCamera();
        }

        // SUBMIT SECURITY REPORT
        function submitSecurityReport() {
            const shift = document.getElementById('securityShift').value;
            const officer = document.getElementById('securityOfficer').value;
            const report = document.getElementById('securityReport').value;
            const incident = document.getElementById('securityIncident').value;
            
            if (!shift || !officer || !report) {
                alert('‚ùå Harap isi shift, nama petugas, dan laporan!');
                return;
            }
            
            // Create WhatsApp message
            let waMessage = `üõ°Ô∏è LAPORAN SECURITY\n\n`;
            waMessage += `Shift: ${shift}\n`;
            waMessage += `Petugas: ${officer}\n`;
            waMessage += `Laporan: ${report}\n`;
            if (incident) waMessage += `Insiden: ${incident}\n`;
            waMessage += `\nStatus: ‚úÖ Diterima`;
            
            // Send WhatsApp
            const phoneNumber = CONFIG.whatsapp.testMode
                ? CONFIG.whatsapp.testPhone
                : CONFIG.whatsapp.phone;
            
            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(waMessage)}`, '_blank');
            
            // Save locally
            const securityReport = {
                shift: shift,
                officer: officer,
                report: report,
                incident: incident || '',
                timestamp: new Date().toISOString()
            };
            
            saveToLocalStorage('security_reports', securityReport);
            
            alert('‚úÖ Laporan security terkirim!');
            
            // Reset form
            resetSecurityForm();
        }

        function resetSecurityForm() {
            document.getElementById('securityShift').value = 'pagi';
            document.getElementById('securityOfficer').value = '';
            document.getElementById('securityReport').value = '';
            document.getElementById('securityIncident').value = '';
        }

        // INVENTORY TABS
        function showInventoryTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('#inventoryTab .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show selected tab content
            document.querySelectorAll('#inventoryTab .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load data for tab
            if (tabName === 'sarana') {
                loadSaranaList();
            } else if (tabName === 'alat') {
                loadAlatList();
            } else if (tabName === 'gudang') {
                loadWarehouseList();
            }
        }

        function loadSaranaList() {
            const container = document.getElementById('saranaList');
            let html = '';
            
            SARANA.forEach(sarana => {
                html += `
                    <div style="padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong>${sarana.name}</strong> (${sarana.division})<br>
                        <small>Include: ${sarana.includes.join(', ') || 'Tidak ada'}</small><br>
                        <span style="color: ${sarana.status === 'active' ? '#2ed573' : '#ff4757'}; font-size: 0.9rem;">
                            ${sarana.status === 'active' ? '‚úÖ Tersedia' : 'üîß Maintenance'}
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadAlatList() {
            const container = document.getElementById('alatList');
            let html = '';
            
            ALAT.forEach(tool => {
                const percentage = (tool.available / tool.total) * 100;
                html += `
                    <div style="padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <strong>${tool.name}</strong><br>
                        <small>Kategori: ${tool.category}</small><br>
                        <div style="margin-top: 5px;">
                            <div style="background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; overflow: hidden;">
                                <div style="background: ${percentage > 50 ? '#2ed573' : percentage > 20 ? '#ffa502' : '#ff4757'}; 
                                            width: ${percentage}%; height: 100%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 5px;">
                                <span>Tersedia: ${tool.available}</span>
                                <span>Total: ${tool.total}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadWarehouseList() {
            const container = document.getElementById('warehouseList');
            let html = '';
            
            // Group by location
            const byLocation = {};
            ALAT.forEach(tool => {
                if (!byLocation[tool.location]) byLocation[tool.location] = [];
                byLocation[tool.location].push(tool);
            });
            
            for (const [location, tools] of Object.entries(byLocation)) {
                html += `<h4 style="margin-top: 20px; color: var(--dream-gold);">üìç ${location}</h4>`;
                
                tools.forEach(tool => {
                    html += `
                        <div style="padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.03); border-radius: 5px;">
                            ${tool.name} ‚Ä¢ ${tool.available}/${tool.total}
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html || '<p style="text-align: center; color: #a0a0c0;">Data gudang akan segera diupdate</p>';
        }

        // ADMIN FUNCTIONS
        function openAdmin() {
            showTab('admin');
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === CONFIG.passwords.admin) {
                document.getElementById('adminContent').style.display = 'block';
                loadAdminStats();
            } else {
                alert('‚ùå Password admin salah!');
            }
        }

        function loadAdminStats() {
            const statsContainer = document.getElementById('adminStats');
            
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const k3Reports = JSON.parse(localStorage.getItem('k3_reports') || '[]');
            const securityReports = JSON.parse(localStorage.getItem('security_reports') || '[]');
            
            statsContainer.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem;">${bookings.length}</div>
                    <small>Bookings</small>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem;">${k3Reports.length}</div>
                    <small>K3 Reports</small>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem;">${securityReports.length}</div>
                    <small>Security Reports</small>
                </div>
            `;
        }

        function exportAllData() {
            const data = {
                app: CONFIG.appName,
                version: CONFIG.version,
                exported: new Date().toISOString(),
                bookings: JSON.parse(localStorage.getItem('bookings') || '[]'),
                k3_reports: JSON.parse(localStorage.getItem('k3_reports') || '[]'),
                security_reports: JSON.parse(localStorage.getItem('security_reports') || '[]')
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dream_os_backup_${Date.now()}.json`;
            a.click();
            
            alert('üì• Data berhasil di-export!');
        }

        function clearAllData() {
            if (confirm('üßπ Hapus SEMUA data? Tindakan ini tidak bisa dibatalkan!')) {
                localStorage.clear();
                alert('‚úÖ Semua data berhasil dihapus!');
                loadAdminStats();
                loadRecentBookings();
            }
        }

        // ARCHITECT FUNCTIONS
        function showArchitectTools() {
            document.getElementById('architectModal').style.display = 'flex';
        }

        function unlockArchitect() {
            const code = document.getElementById('architectCode').value;
            
            if (code === CONFIG.passwords.architect) {
                document.getElementById('architectTools').style.display = 'block';
                alert('üëª Architect Mode Unlocked!');
            } else {
                alert('‚ùå Architect code salah!');
            }
        }

        function closeArchitectModal() {
            document.getElementById('architectModal').style.display = 'none';
            document.getElementById('architectCode').value = '';
            document.getElementById('architectTools').style.display = 'none';
        }

        function clearCache() {
            if (confirm('Clear semua cache dan reload?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function showSystemLogs() {
            console.log('=== DREAM OS SYSTEM LOGS ===');
            console.log('User Agent:', navigator.userAgent);
            console.log('Platform:', navigator.platform);
            console.log('LocalStorage items:', localStorage.length);
            console.log('Screen:', window.screen.width + 'x' + window.screen.height);
            alert('üìã Logs ditampilkan di console (F12)');
        }

        function toggleDebugMode() {
            const debug = localStorage.getItem('debug') === 'true';
            localStorage.setItem('debug', !debug);
            alert(`üêõ Debug mode ${!debug ? 'ENABLED' : 'DISABLED'}!`);
            location.reload();
        }

        function resetSystem() {
            if (confirm('Reset semua pengaturan ke default?')) {
                localStorage.clear();
                // Set default settings
                localStorage.setItem('welcome_shown', 'true');
                alert('üîÑ System reset berhasil!');
                location.reload();
            }
        }

        // UTILITY FUNCTIONS
        function showTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load data if needed
            if (tabName === 'booking') {
                loadRecentBookings();
            } else if (tabName === 'inventory') {
                showInventoryTab('sarana');
            }
        }

        function updateConnectionStatus() {
            const isOnline = navigator.onLine;
            const statusElement = document.getElementById('connectionStatus');
            
            if (isOnline) {
                statusElement.innerHTML = '‚úÖ Online';
                statusElement.style.color = '#2ed573';
            } else {
                statusElement.innerHTML = 'üì¥ Offline Mode';
                statusElement.style.color = '#ffa502';
            }
            
            // Update footer status
            document.getElementById('appStatus').textContent = isOnline ? 'üü¢ Online' : 'üü° Offline';
            document.getElementById('dataCount').textContent = 
                `${JSON.parse(localStorage.getItem('bookings') || '[]').length} items`;
            document.getElementById('storageType').textContent = 'üíæ Local';
            
            // Listen for connection changes
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showTab(this.textContent.toLowerCase().replace(/[^a-z]/g, ''));
                });
            });
            
            // Initialize inventory tabs
            document.querySelectorAll('#inventoryTab .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.textContent.toLowerCase().replace(/[^a-z]/g, '');
                    showInventoryTab(tabName);
                });
            });
            
            // Welcome message
            if (!localStorage.getItem('welcome_shown')) {
                setTimeout(() => {
                    alert(`üåô Selamat datang di DREAM OS v2.0!\n\n` +
                          `Fitur lengkap:\n` +
                          `‚Ä¢ 18 Sarana + 12 Alat real\n` +
                          `‚Ä¢ Aturan booking: Senin-Kamis 07:30-16:00, Jumat 10:30-13:00\n` +
                          `‚Ä¢ Kamera untuk laporan K3\n` +
                          `‚Ä¢ Works 100% offline\n\n` +
                          `Dream Team: Mr. M + Mr. DSeek + Mrs. Qwen`);
                    localStorage.setItem('welcome_shown', 'true');
                }, 1000);
            }
        }

        // PWA INSTALLATION
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after 5 seconds
            setTimeout(() => {
                if (confirm('üì± Install DREAM OS sebagai app di homescreen?')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => {
                        deferredPrompt = null;
                    });
                }
            }, 5000);
        });

        // SERVICE WORKER REGISTRATION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }

        // INITIALIZE ON LOAD
        window.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>
